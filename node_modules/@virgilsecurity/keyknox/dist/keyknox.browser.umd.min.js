!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("virgil-crypto")):"function"==typeof define&&define.amd?define(["exports","virgil-crypto"],e):e((t=t||self).Keyknox={},t.VirgilCrypto)}(this,function(t,e){"use strict";var r="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},u=[],c=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,h=!1;function l(){h=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,r=t.length;e<r;++e)u[e]=t[e],c[t.charCodeAt(e)]=e;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63}function p(t,e,r){for(var n,o,i=[],s=e;s<r;s+=3)n=(t[s]<<16)+(t[s+1]<<8)+t[s+2],i.push(u[(o=n)>>18&63]+u[o>>12&63]+u[o>>6&63]+u[63&o]);return i.join("")}function n(t){var e;h||l();for(var r=t.length,n=r%3,o="",i=[],s=0,a=r-n;s<a;s+=16383)i.push(p(t,s,a<s+16383?a:s+16383));return 1===n?(e=t[r-1],o+=u[e>>2],o+=u[e<<4&63],o+="=="):2===n&&(e=(t[r-2]<<8)+t[r-1],o+=u[e>>10],o+=u[e>>4&63],o+=u[e<<2&63],o+="="),i.push(o),i.join("")}function o(t,e,r,n,o){var i,s,a=8*o-n-1,u=(1<<a)-1,c=u>>1,f=-7,h=r?o-1:0,l=r?-1:1,p=t[e+h];for(h+=l,i=p&(1<<-f)-1,p>>=-f,f+=a;0<f;i=256*i+t[e+h],h+=l,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=n;0<f;s=256*s+t[e+h],h+=l,f-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),i-=c}return(p?-1:1)*s*Math.pow(2,i-n)}function i(t,e,r,n,o,i){var s,a,u,c=8*i-o-1,f=(1<<c)-1,h=f>>1,l=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:i-1,y=n?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),2<=(e+=1<=s+h?l/u:l*Math.pow(2,1-h))*u&&(s++,u/=2),f<=s+h?(a=0,s=f):1<=s+h?(a=(e*u-1)*Math.pow(2,o),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,o),s=0));8<=o;t[r+p]=255&a,p+=y,a/=256,o-=8);for(s=s<<o|a,c+=o;0<c;t[r+p]=255&s,p+=y,s/=256,c-=8);t[r+p-y]|=128*d}var s={}.toString,a=Array.isArray||function(t){return"[object Array]"==s.call(t)};function y(){return g.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function d(t,e){if(y()<e)throw new RangeError("Invalid typed array length");return g.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=g.prototype:(null===t&&(t=new g(e)),t.length=e),t}function g(t,e,r){if(!(g.TYPED_ARRAY_SUPPORT||this instanceof g))return new g(t,e,r);if("number"!=typeof t)return v(this,t,e,r);if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return m(this,t)}function v(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);g.TYPED_ARRAY_SUPPORT?(t=e).__proto__=g.prototype:t=E(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!g.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|x(e,r),o=(t=d(t,n)).write(e,r);o!==n&&(t=t.slice(0,o));return t}(t,e,r):function(t,e){if(k(e)){var r=0|b(e.length);return 0===(t=d(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?d(t,0):E(t,e);if("Buffer"===e.type&&a(e.data))return E(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function w(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function m(t,e){if(w(e),t=d(t,e<0?0:0|b(e)),!g.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function E(t,e){var r=e.length<0?0:0|b(e.length);t=d(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function b(t){if(t>=y())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+y().toString(16)+" bytes");return 0|t}function k(t){return!(null==t||!t._isBuffer)}function x(t,e){if(k(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return q(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(t).length;default:if(n)return q(t).length;e=(""+e).toLowerCase(),n=!0}}function A(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function S(t,e,r,n,o){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=o?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(o)return-1;r=t.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof e&&(e=g.from(e,n)),k(e))return 0===e.length?-1:P(t,e,r,n,o);if("number"==typeof e)return e&=255,g.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):P(t,[e],r,n,o);throw new TypeError("val must be string, number or Buffer")}function P(t,e,r,n,o){var i,s=1,a=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a/=s=2,u/=2,r/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(o){var f=-1;for(i=r;i<a;i++)if(c(t,i)===c(e,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===u)return f*s}else-1!==f&&(i-=i-f),f=-1}else for(a<r+u&&(r=a-u),i=r;0<=i;i--){for(var h=!0,l=0;l<u;l++)if(c(t,i+l)!==c(e,l)){h=!1;break}if(h)return i}return-1}function R(t,e,r,n){r=Number(r)||0;var o=t.length-r;n?o<(n=Number(n))&&(n=o):n=o;var i=e.length;if(i%2!=0)throw new TypeError("Invalid hex string");i/2<n&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[r+s]=a}return s}function T(t,e,r,n){return H(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function C(t,e,r){return 0===e&&r===t.length?n(t):n(t.slice(e,r))}function K(t,e,r){r=Math.min(t.length,r);for(var n=[],o=e;o<r;){var i,s,a,u,c=t[o],f=null,h=239<c?4:223<c?3:191<c?2:1;if(o+h<=r)switch(h){case 1:c<128&&(f=c);break;case 2:128==(192&(i=t[o+1]))&&127<(u=(31&c)<<6|63&i)&&(f=u);break;case 3:i=t[o+1],s=t[o+2],128==(192&i)&&128==(192&s)&&2047<(u=(15&c)<<12|(63&i)<<6|63&s)&&(u<55296||57343<u)&&(f=u);break;case 4:i=t[o+1],s=t[o+2],a=t[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&65535<(u=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&a)&&u<1114112&&(f=u)}null===f?(f=65533,h=1):65535<f&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),o+=h}return function(t){var e=t.length;if(e<=_)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=_));return r}(n)}g.TYPED_ARRAY_SUPPORT=void 0===r.TYPED_ARRAY_SUPPORT||r.TYPED_ARRAY_SUPPORT,g.poolSize=8192,g._augment=function(t){return t.__proto__=g.prototype,t},g.from=function(t,e,r){return v(null,t,e,r)},g.TYPED_ARRAY_SUPPORT&&(g.prototype.__proto__=Uint8Array.prototype,g.__proto__=Uint8Array),g.alloc=function(t,e,r){return n=null,i=e,s=r,w(o=t),o<=0?d(n,o):void 0!==i?"string"==typeof s?d(n,o).fill(i,s):d(n,o).fill(i):d(n,o);var n,o,i,s},g.allocUnsafe=function(t){return m(null,t)},g.allocUnsafeSlow=function(t){return m(null,t)},g.isBuffer=function(t){return null!=t&&(!!t._isBuffer||X(t)||(e=t,"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&X(e.slice(0,0))));var e},g.compare=function(t,e){if(!k(t)||!k(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,o=0,i=Math.min(r,n);o<i;++o)if(t[o]!==e[o]){r=t[o],n=e[o];break}return r<n?-1:n<r?1:0},g.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},g.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return g.alloc(0);var r;if(void 0===e)for(r=e=0;r<t.length;++r)e+=t[r].length;var n=g.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){var i=t[r];if(!k(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,o),o+=i.length}return n},g.byteLength=x,g.prototype._isBuffer=!0,g.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)A(this,e,e+1);return this},g.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)A(this,e,e+3),A(this,e+1,e+2);return this},g.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)A(this,e,e+7),A(this,e+1,e+6),A(this,e+2,e+5),A(this,e+3,e+4);return this},g.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?K(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return O(this,e,r);case"utf8":case"utf-8":return K(this,e,r);case"ascii":return U(this,e,r);case"latin1":case"binary":return D(this,e,r);case"base64":return C(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},g.prototype.equals=function(t){if(!k(t))throw new TypeError("Argument must be a Buffer");return this===t||0===g.compare(this,t)},g.prototype.inspect=function(){var t="";return 0<this.length&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(t+=" ... ")),"<Buffer "+t+">"},g.prototype.compare=function(t,e,r,n,o){if(!k(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),e<0||r>t.length||n<0||o>this.length)throw new RangeError("out of range index");if(o<=n&&r<=e)return 0;if(o<=n)return-1;if(r<=e)return 1;if(this===t)return 0;for(var i=(o>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),a=Math.min(i,s),u=this.slice(n,o),c=t.slice(e,r),f=0;f<a;++f)if(u[f]!==c[f]){i=u[f],s=c[f];break}return i<s?-1:s<i?1:0},g.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},g.prototype.indexOf=function(t,e,r){return S(this,t,e,r,!0)},g.prototype.lastIndexOf=function(t,e,r){return S(this,t,e,r,!1)},g.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-e;if((void 0===r||o<r)&&(r=o),0<t.length&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i,s,a,u,c,f,h,l,p,y=!1;;)switch(n){case"hex":return R(this,t,e,r);case"utf8":case"utf-8":return l=e,p=r,H(q(t,(h=this).length-l),h,l,p);case"ascii":return T(this,t,e,r);case"latin1":case"binary":return T(this,t,e,r);case"base64":return u=this,c=e,f=r,H(z(t),u,c,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=e,a=r,H(function(t,e){for(var r,n,o,i=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(t,(i=this).length-s),i,s,a);default:if(y)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),y=!0}},g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function U(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(127&t[o]);return n}function D(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(t[o]);return n}function O(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||n<r)&&(r=n);for(var o="",i=e;i<r;++i)o+=F(t[i]);return o}function B(t,e,r){for(var n=t.slice(e,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function I(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(r<t+e)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,r,n,o,i){if(!k(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<e||e<i)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function N(t,e,r,n){e<0&&(e=65535+e+1);for(var o=0,i=Math.min(t.length-r,2);o<i;++o)t[r+o]=(e&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function Y(t,e,r,n){e<0&&(e=4294967295+e+1);for(var o=0,i=Math.min(t.length-r,4);o<i;++o)t[r+o]=e>>>8*(n?o:3-o)&255}function V(t,e,r,n,o,i){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function j(t,e,r,n,o){return o||V(t,0,r,4),i(t,e,r,n,23,4),r+4}function M(t,e,r,n,o){return o||V(t,0,r,8),i(t,e,r,n,52,8),r+8}g.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),e<t&&(e=t),g.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=g.prototype;else{var o=e-t;r=new g(o,void 0);for(var i=0;i<o;++i)r[i]=this[i+t]}return r},g.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||I(t,e,this.length);for(var n=this[t],o=1,i=0;++i<e&&(o*=256);)n+=this[t+i]*o;return n},g.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||I(t,e,this.length);for(var n=this[t+--e],o=1;0<e&&(o*=256);)n+=this[t+--e]*o;return n},g.prototype.readUInt8=function(t,e){return e||I(t,1,this.length),this[t]},g.prototype.readUInt16LE=function(t,e){return e||I(t,2,this.length),this[t]|this[t+1]<<8},g.prototype.readUInt16BE=function(t,e){return e||I(t,2,this.length),this[t]<<8|this[t+1]},g.prototype.readUInt32LE=function(t,e){return e||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},g.prototype.readUInt32BE=function(t,e){return e||I(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},g.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||I(t,e,this.length);for(var n=this[t],o=1,i=0;++i<e&&(o*=256);)n+=this[t+i]*o;return(o*=128)<=n&&(n-=Math.pow(2,8*e)),n},g.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||I(t,e,this.length);for(var n=e,o=1,i=this[t+--n];0<n&&(o*=256);)i+=this[t+--n]*o;return(o*=128)<=i&&(i-=Math.pow(2,8*e)),i},g.prototype.readInt8=function(t,e){return e||I(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},g.prototype.readInt16LE=function(t,e){e||I(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},g.prototype.readInt16BE=function(t,e){e||I(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},g.prototype.readInt32LE=function(t,e){return e||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},g.prototype.readInt32BE=function(t,e){return e||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},g.prototype.readFloatLE=function(t,e){return e||I(t,4,this.length),o(this,t,!0,23,4)},g.prototype.readFloatBE=function(t,e){return e||I(t,4,this.length),o(this,t,!1,23,4)},g.prototype.readDoubleLE=function(t,e){return e||I(t,8,this.length),o(this,t,!0,52,8)},g.prototype.readDoubleBE=function(t,e){return e||I(t,8,this.length),o(this,t,!1,52,8)},g.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||L(this,t,e,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[e]=255&t;++i<r&&(o*=256);)this[e+i]=t/o&255;return e+r},g.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||L(this,t,e,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[e+o]=255&t;0<=--o&&(i*=256);)this[e+o]=t/i&255;return e+r},g.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,1,255,0),g.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},g.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},g.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},g.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Y(this,t,e,!0),e+4},g.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Y(this,t,e,!1),e+4},g.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var o=Math.pow(2,8*r-1);L(this,t,e,r,o-1,-o)}var i=0,s=1,a=0;for(this[e]=255&t;++i<r&&(s*=256);)t<0&&0===a&&0!==this[e+i-1]&&(a=1),this[e+i]=(t/s>>0)-a&255;return e+r},g.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var o=Math.pow(2,8*r-1);L(this,t,e,r,o-1,-o)}var i=r-1,s=1,a=0;for(this[e+i]=255&t;0<=--i&&(s*=256);)t<0&&0===a&&0!==this[e+i+1]&&(a=1),this[e+i]=(t/s>>0)-a&255;return e+r},g.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,1,127,-128),g.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},g.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},g.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},g.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,4,2147483647,-2147483648),g.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Y(this,t,e,!0),e+4},g.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Y(this,t,e,!1),e+4},g.prototype.writeFloatLE=function(t,e,r){return j(this,t,e,!0,r)},g.prototype.writeFloatBE=function(t,e,r){return j(this,t,e,!1,r)},g.prototype.writeDoubleLE=function(t,e,r){return M(this,t,e,!0,r)},g.prototype.writeDoubleBE=function(t,e,r){return M(this,t,e,!1,r)},g.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),0<n&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var o,i=n-r;if(this===t&&r<e&&e<n)for(o=i-1;0<=o;--o)t[o+e]=this[o+r];else if(i<1e3||!g.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)t[o+e]=this[o+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+i),e);return i},g.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var o=t.charCodeAt(0);o<256&&(t=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!g.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var i;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{var s=k(t)?t:q(new g(t,n).toString()),a=s.length;for(i=0;i<r-e;++i)this[i+e]=s[i%a]}return this};var W=/[^+\/0-9A-Za-z-_]/g;function F(t){return t<16?"0"+t.toString(16):t.toString(16)}function q(t,e){var r;e=e||1/0;for(var n=t.length,o=null,i=[],s=0;s<n;++s){if(55295<(r=t.charCodeAt(s))&&r<57344){if(!o){if(56319<r){-1<(e-=3)&&i.push(239,191,189);continue}if(s+1===n){-1<(e-=3)&&i.push(239,191,189);continue}o=r;continue}if(r<56320){-1<(e-=3)&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&-1<(e-=3)&&i.push(239,191,189);if(o=null,r<128){if((e-=1)<0)break;i.push(r)}else if(r<2048){if((e-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function z(t){return function(t){var e,r,n,o,i,s;h||l();var a=t.length;if(0<a%4)throw new Error("Invalid string. Length must be a multiple of 4");i="="===t[a-2]?2:"="===t[a-1]?1:0,s=new f(3*a/4-i),n=0<i?a-4:a;var u=0;for(r=e=0;e<n;e+=4,r+=3)o=c[t.charCodeAt(e)]<<18|c[t.charCodeAt(e+1)]<<12|c[t.charCodeAt(e+2)]<<6|c[t.charCodeAt(e+3)],s[u++]=o>>16&255,s[u++]=o>>8&255,s[u++]=255&o;return 2===i?(o=c[t.charCodeAt(e)]<<2|c[t.charCodeAt(e+1)]>>4,s[u++]=255&o):1===i&&(o=c[t.charCodeAt(e)]<<10|c[t.charCodeAt(e+1)]<<4|c[t.charCodeAt(e+2)]>>2,s[u++]=o>>8&255,s[u++]=255&o),s}(function(t){var e;if((t=(e=t,e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")).replace(W,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function H(t,e,r,n){for(var o=0;o<n&&!(o+r>=e.length||o>=t.length);++o)e[o+r]=t[o];return o}function X(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var J=function(t,e){return(J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function G(t,e){function r(){this.constructor=t}J(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Z=function(){return(Z=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function $(i,s,a,u){return new(a||(a=Promise))(function(t,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function n(t){try{o(u.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(r,n)}o((u=u.apply(i,s||[])).next())})}function Q(r,n){var o,i,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,i=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(r,a)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var tt=function(r,n){return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];return r.apply(n,t)}};function et(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var rt=Object.prototype.toString;function nt(t){return"[object Array]"===rt.call(t)}function ot(t){return null!==t&&"object"==typeof t}function it(t){return"[object Function]"===rt.call(t)}function st(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),nt(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.call(null,t[o],o,t)}var at={isArray:nt,isArrayBuffer:function(t){return"[object ArrayBuffer]"===rt.call(t)},isBuffer:function(t){return null!=t&&(et(t)||"function"==typeof(e=t).readFloatLE&&"function"==typeof e.slice&&et(e.slice(0,0))||!!t._isBuffer);var e},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:ot,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===rt.call(t)},isFile:function(t){return"[object File]"===rt.call(t)},isBlob:function(t){return"[object Blob]"===rt.call(t)},isFunction:it,isStream:function(t){return ot(t)&&it(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:st,merge:function r(){var n={};function t(t,e){"object"==typeof n[e]&&"object"==typeof t?n[e]=r(n[e],t):n[e]=t}for(var e=0,o=arguments.length;e<o;e++)st(arguments[e],t);return n},extend:function(r,t,n){return st(t,function(t,e){r[e]=n&&"function"==typeof t?tt(t,n):t}),r},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}};function ut(){throw new Error("setTimeout has not been defined")}function ct(){throw new Error("clearTimeout has not been defined")}var ft=ut,ht=ct;function lt(e){if(ft===setTimeout)return setTimeout(e,0);if((ft===ut||!ft)&&setTimeout)return ft=setTimeout,setTimeout(e,0);try{return ft(e,0)}catch(t){try{return ft.call(null,e,0)}catch(t){return ft.call(this,e,0)}}}"function"==typeof r.setTimeout&&(ft=setTimeout),"function"==typeof r.clearTimeout&&(ht=clearTimeout);var pt,yt=[],dt=!1,gt=-1;function vt(){dt&&pt&&(dt=!1,pt.length?yt=pt.concat(yt):gt=-1,yt.length&&wt())}function wt(){if(!dt){var t=lt(vt);dt=!0;for(var e=yt.length;e;){for(pt=yt,yt=[];++gt<e;)pt&&pt[gt].run();gt=-1,e=yt.length}pt=null,dt=!1,function(e){if(ht===clearTimeout)return clearTimeout(e);if((ht===ct||!ht)&&clearTimeout)return ht=clearTimeout,clearTimeout(e);try{ht(e)}catch(t){try{return ht.call(null,e)}catch(t){return ht.call(this,e)}}}(t)}}function mt(t,e){this.fun=t,this.array=e}mt.prototype.run=function(){this.fun.apply(null,this.array)};function Et(){}var bt=Et,kt=Et,xt=Et,At=Et,St=Et,Pt=Et,Rt=Et;var Tt=r.performance||{},Ct=Tt.now||Tt.mozNow||Tt.msNow||Tt.oNow||Tt.webkitNow||function(){return(new Date).getTime()};var Kt=new Date;var _t={nextTick:function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];yt.push(new mt(t,e)),1!==yt.length||dt||lt(wt)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:bt,addListener:kt,once:xt,off:At,removeListener:St,removeAllListeners:Pt,emit:Rt,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*Ct.call(Tt),r=Math.floor(e),n=Math.floor(e%1*1e9);return t&&(r-=t[0],(n-=t[1])<0&&(r--,n+=1e9)),[r,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Kt)/1e3}},Ut=function(t,e,r,n,o){var i,s,a,u,c,f=new Error(t);return s=e,a=r,u=n,c=o,(i=f).config=s,a&&(i.code=a),i.request=u,i.response=c,i};function Dt(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Ot=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Bt=at.isStandardBrowserEnv()?function(){var r,n=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a");function i(t){var e=t;return n&&(o.setAttribute("href",e),e=o.href),o.setAttribute("href",e),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:"/"===o.pathname.charAt(0)?o.pathname:"/"+o.pathname}}return r=i(window.location.href),function(t){var e=at.isString(t)?i(t):t;return e.protocol===r.protocol&&e.host===r.host}}():function(){return!0};function It(){this.message="String contains an invalid character"}(It.prototype=new Error).code=5,It.prototype.name="InvalidCharacterError";var Lt=function(t){for(var e,r,n=String(t),o="",i=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.charAt(0|i)||(s="=",i%1);o+=s.charAt(63&e>>8-i%1*8)){if(255<(r=n.charCodeAt(i+=.75)))throw new It;e=e<<8|r}return o},Nt=at.isStandardBrowserEnv()?{write:function(t,e,r,n,o,i){var s=[];s.push(t+"="+encodeURIComponent(e)),at.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),at.isString(n)&&s.push("path="+n),at.isString(o)&&s.push("domain="+o),!0===i&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Yt="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||Lt,Vt=function(d){return new Promise(function(h,l){var r=d.data,n=d.headers;at.isFormData(r)&&delete n["Content-Type"];var p=new XMLHttpRequest,t="onreadystatechange",y=!1;if("test"===_t.env.NODE_ENV||"undefined"==typeof window||!window.XDomainRequest||"withCredentials"in p||Bt(d.url)||(p=new window.XDomainRequest,t="onload",y=!0,p.onprogress=function(){},p.ontimeout=function(){}),d.auth){var e=d.auth.username||"",o=d.auth.password||"";n.Authorization="Basic "+Yt(e+":"+o)}if(p.open(d.method.toUpperCase(),function(t,e,r){if(!e)return t;var n;if(r)n=r(e);else if(at.isURLSearchParams(e))n=e.toString();else{var o=[];at.forEach(e,function(t,e){null!=t&&(at.isArray(t)?e+="[]":t=[t],at.forEach(t,function(t){at.isDate(t)?t=t.toISOString():at.isObject(t)&&(t=JSON.stringify(t)),o.push(Dt(e)+"="+Dt(t))}))}),n=o.join("&")}return n&&(t+=(-1===t.indexOf("?")?"?":"&")+n),t}(d.url,d.params,d.paramsSerializer),!0),p.timeout=d.timeout,p[t]=function(){if(p&&(4===p.readyState||y)&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var t,e,r,n,o,i,s,a,u,c="getAllResponseHeaders"in p?(t=p.getAllResponseHeaders(),o={},t&&at.forEach(t.split("\n"),function(t){if(n=t.indexOf(":"),e=at.trim(t.substr(0,n)).toLowerCase(),r=at.trim(t.substr(n+1)),e){if(o[e]&&0<=Ot.indexOf(e))return;o[e]="set-cookie"===e?(o[e]?o[e]:[]).concat([r]):o[e]?o[e]+", "+r:r}}),o):null,f={data:d.responseType&&"text"!==d.responseType?p.response:p.responseText,status:1223===p.status?204:p.status,statusText:1223===p.status?"No Content":p.statusText,headers:c,config:d,request:p};i=h,s=l,u=(a=f).config.validateStatus,a.status&&u&&!u(a.status)?s(Ut("Request failed with status code "+a.status,a.config,null,a.request,a)):i(a),p=null}},p.onerror=function(){l(Ut("Network Error",d,null,p)),p=null},p.ontimeout=function(){l(Ut("timeout of "+d.timeout+"ms exceeded",d,"ECONNABORTED",p)),p=null},at.isStandardBrowserEnv()){var i=Nt,s=(d.withCredentials||Bt(d.url))&&d.xsrfCookieName?i.read(d.xsrfCookieName):void 0;s&&(n[d.xsrfHeaderName]=s)}if("setRequestHeader"in p&&at.forEach(n,function(t,e){void 0===r&&"content-type"===e.toLowerCase()?delete n[e]:p.setRequestHeader(e,t)}),d.withCredentials&&(p.withCredentials=!0),d.responseType)try{p.responseType=d.responseType}catch(t){if("json"!==d.responseType)throw t}"function"==typeof d.onDownloadProgress&&p.addEventListener("progress",d.onDownloadProgress),"function"==typeof d.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",d.onUploadProgress),d.cancelToken&&d.cancelToken.promise.then(function(t){p&&(p.abort(),l(t),p=null)}),void 0===r&&(r=null),p.send(r)})},jt={"Content-Type":"application/x-www-form-urlencoded"};function Mt(t,e){!at.isUndefined(t)&&at.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var Wt,Ft={adapter:("undefined"!=typeof XMLHttpRequest?Wt=Vt:void 0!==_t&&(Wt=Vt),Wt),transformRequest:[function(t,e){var r,n;return r=e,n="Content-Type",at.forEach(r,function(t,e){e!==n&&e.toUpperCase()===n.toUpperCase()&&(r[n]=t,delete r[e])}),at.isFormData(t)||at.isArrayBuffer(t)||at.isBuffer(t)||at.isStream(t)||at.isFile(t)||at.isBlob(t)?t:at.isArrayBufferView(t)?t.buffer:at.isURLSearchParams(t)?(Mt(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):at.isObject(t)?(Mt(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return 200<=t&&t<300}};Ft.headers={common:{Accept:"application/json, text/plain, */*"}},at.forEach(["delete","get","head"],function(t){Ft.headers[t]={}}),at.forEach(["post","put","patch"],function(t){Ft.headers[t]=at.merge(jt)});var qt=Ft;function zt(){this.handlers=[]}zt.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},zt.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},zt.prototype.forEach=function(e){at.forEach(this.handlers,function(t){null!==t&&e(t)})};var Ht=zt,Xt=function(e,r,t){return at.forEach(t,function(t){e=t(e,r)}),e},Jt=function(t){return!(!t||!t.__CANCEL__)};function Gt(t){t.cancelToken&&t.cancelToken.throwIfRequested()}var Zt=function(e){var t,r,n;return Gt(e),e.baseURL&&(n=e.url,!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(n))&&(e.url=(t=e.baseURL,(r=e.url)?t.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):t)),e.headers=e.headers||{},e.data=Xt(e.data,e.headers,e.transformRequest),e.headers=at.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),at.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||qt.adapter)(e).then(function(t){return Gt(e),t.data=Xt(t.data,t.headers,e.transformResponse),t},function(t){return Jt(t)||(Gt(e),t&&t.response&&(t.response.data=Xt(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})};function $t(t){this.defaults=t,this.interceptors={request:new Ht,response:new Ht}}$t.prototype.request=function(t){"string"==typeof t&&(t=at.merge({url:arguments[0]},arguments[1])),(t=at.merge(qt,{method:"get"},this.defaults,t)).method=t.method.toLowerCase();var e=[Zt,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)r=r.then(e.shift(),e.shift());return r},at.forEach(["delete","get","head","options"],function(r){$t.prototype[r]=function(t,e){return this.request(at.merge(e||{},{method:r,url:t}))}}),at.forEach(["post","put","patch"],function(n){$t.prototype[n]=function(t,e,r){return this.request(at.merge(r||{},{method:n,url:t,data:e}))}});var Qt=$t;function te(t){this.message=t}te.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},te.prototype.__CANCEL__=!0;var ee=te;function re(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var r=this;t(function(t){r.reason||(r.reason=new ee(t),e(r.reason))})}re.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},re.source=function(){var e;return{token:new re(function(t){e=t}),cancel:e}};var ne=re;function oe(t){var e=new Qt(t),r=tt(Qt.prototype.request,e);return at.extend(r,Qt.prototype,e),at.extend(r,e),r}var ie=oe(qt);ie.Axios=Qt,ie.create=function(t){return oe(at.merge(qt,t))},ie.Cancel=ee,ie.CancelToken=ne,ie.isCancel=Jt,ie.all=function(t){return Promise.all(t)},ie.spread=function(e){return function(t){return e.apply(null,t)}};var se=ie,ae=ie;se.default=ae;var ue=se,ce=function(n){function t(t){var e=this.constructor,r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r.name="KeyknoxError",r}return G(t,n),t}(Error),fe=function(o){function t(t,e,r){var n=o.call(this,t)||this;return n.name="KeyknoxClientError",n.status=e,n.code=r,n}return G(t,o),t}(ce),he=function(e){function t(){var t=e.call(this,"CloudKeyStorage is out of sync")||this;return t.name="CloudKeyStorageOutOfSyncError",t}return G(t,e),t}(ce),le=function(r){function t(t){var e=r.call(this,"Cloud entry '"+t+"' already exists")||this;return e.name="CloudEntryExistsError",e.cloudEntryName=t,e}return G(t,r),t}(ce),pe=function(r){function t(t){var e=r.call(this,"Cloud entry '"+t+"' doesn't exist")||this;return e.name="CloudEntryDoesntExistError",e.cloudEntryName=t,e}return G(t,r),t}(ce),ye=function(r){function t(t){var e=r.call(this,"Key entry '"+t+"' already exists")||this;return e.name="KeyEntryExistsError",e.keyEntryName=t,e}return G(t,r),t}(ce),de=function(r){function t(t){var e=r.call(this,"Key entry '"+t+"' doesn't exist")||this;return e.name="KeyEntryDoesntExistError",e.keyEntryName=t,e}return G(t,r),t}(ce),ge=function(){function u(t,e){this.axios=e||ue.create({baseURL:t||"https://api.virgilsecurity.com"}),this.axios.interceptors.response.use(void 0,u.responseErrorHandler)}return u.prototype.pushValue=function(o,i,s,a){return $(this,void 0,void 0,function(){var e,r,n;return Q(this,function(t){switch(t.label){case 0:return e={meta:o.toString("base64"),value:i.toString("base64")},r={headers:{Authorization:u.getAuthorizationHeader(s)}},a&&(r.headers["Virgil-Keyknox-Previous-Hash"]=a.toString("base64")),[4,this.axios.put("/keyknox/v1",e,r)];case 1:return n=t.sent(),[2,u.getKeyknoxValue(n)]}})})},u.prototype.pullValue=function(n){return $(this,void 0,void 0,function(){var e,r;return Q(this,function(t){switch(t.label){case 0:return e={headers:{Authorization:u.getAuthorizationHeader(n)}},[4,this.axios.get("/keyknox/v1",e)];case 1:return r=t.sent(),[2,u.getKeyknoxValue(r)]}})})},u.prototype.resetValue=function(n){return $(this,void 0,void 0,function(){var e,r;return Q(this,function(t){switch(t.label){case 0:return e={headers:{Authorization:u.getAuthorizationHeader(n)}},[4,this.axios.post("/keyknox/v1/reset",null,e)];case 1:return r=t.sent(),[2,u.getKeyknoxValue(r)]}})})},u.getKeyknoxValue=function(t){var e=t.data,r=t.headers;return{meta:g.from(e.meta,"base64"),value:g.from(e.value,"base64"),version:e.version,keyknoxHash:g.from(r["virgil-keyknox-hash"],"base64")}},u.getAuthorizationHeader=function(t){return u.AUTHORIZATION_PREFIX+" "+t},u.responseErrorHandler=function(t){var e=t.response;if(e){var r=e.data;return r&&r.code&&r.message?Promise.reject(new fe(r.message,e.status,r.code)):Promise.reject(new fe(t.message,e.status))}return Promise.reject(new fe(t.message))},u.AUTHORIZATION_PREFIX="Virgil",u}(),ve=function(){function t(t){this.crypto=t||new e.VirgilCrypto}return t.prototype.decrypt=function(t,e,r){var n=t.value,o=t.meta;if(!n.byteLength||!o.byteLength){if(n.byteLength||o.byteLength)throw new TypeError("'EncryptedKeyknoxValue' is invalid");return t}var i=this.crypto.decryptThenVerifyDetached(n,o,e,r);return Z({},t,{value:i})},t.prototype.encrypt=function(t,e,r){return this.crypto.signThenEncryptDetached(t,e,r)},t}(),we=function(){function t(t,e,r,n,o){this.accessTokenProvider=t,this.myPrivateKey=e,this.myPublicKeys=r,this.keyknoxClient=n||new ge,this.keyknoxCrypto=o||new ve}return Object.defineProperty(t.prototype,"privateKey",{get:function(){return this.myPrivateKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"publicKeys",{get:function(){return this.myPublicKeys},enumerable:!0,configurable:!0}),t.prototype.pushValue=function(s,a){return $(this,void 0,void 0,function(){var e,r,n,o,i;return Q(this,function(t){switch(t.label){case 0:return[4,this.accessTokenProvider.getToken({operation:"put"})];case 1:return e=t.sent(),r=this.keyknoxCrypto.encrypt(s,this.myPrivateKey,this.myPublicKeys),n=r.metadata,o=r.encryptedData,[4,this.keyknoxClient.pushValue(n,o,e.toString(),a)];case 2:return i=t.sent(),[2,this.keyknoxCrypto.decrypt(i,this.myPrivateKey,this.myPublicKeys)]}})})},t.prototype.pullValue=function(){return $(this,void 0,void 0,function(){var e,r;return Q(this,function(t){switch(t.label){case 0:return[4,this.accessTokenProvider.getToken({operation:"get"})];case 1:return e=t.sent(),[4,this.keyknoxClient.pullValue(e.toString())];case 2:return r=t.sent(),[2,this.keyknoxCrypto.decrypt(r,this.myPrivateKey,this.myPublicKeys)]}})})},t.prototype.resetValue=function(){return $(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return[4,this.accessTokenProvider.getToken({operation:"delete"})];case 1:return e=t.sent(),[2,this.keyknoxClient.resetValue(e.toString())]}})})},t.prototype.updateValue=function(h){return $(this,void 0,void 0,function(){var e,r,n,o,i,s,a,u,c,f;return Q(this,function(t){switch(t.label){case 0:return e=h.value,r=h.previousHash,n=h.newPrivateKey,o=h.newPublicKeys,n||o?[4,this.pullValue()]:[2,this.pushValue(e,r)];case 1:return i=t.sent(),n&&(this.myPrivateKey=n),o&&(this.myPublicKeys=o),s=this.keyknoxCrypto.encrypt(i.value,this.myPrivateKey,this.myPublicKeys),a=s.metadata,u=s.encryptedData,[4,this.accessTokenProvider.getToken({operation:"put"})];case 2:return c=t.sent(),[4,this.keyknoxClient.pushValue(a,u,c.toString(),i.keyknoxHash)];case 3:return f=t.sent(),[2,this.keyknoxCrypto.decrypt(f,this.myPrivateKey,this.myPublicKeys)]}})})},t.prototype.updateRecipients=function(c){return $(this,void 0,void 0,function(){var e,r,n,o,i,s,a,u;return Q(this,function(t){switch(t.label){case 0:return e=c.newPrivateKey,r=c.newPublicKeys,[4,this.pullValue()];case 1:return(n=t.sent()).meta.byteLength||n.value.byteLength?(e&&(this.myPrivateKey=e),r&&(this.myPublicKeys=r),o=this.keyknoxCrypto.encrypt(n.value,this.myPrivateKey,this.myPublicKeys),i=o.metadata,s=o.encryptedData,[4,this.accessTokenProvider.getToken({operation:"put"})]):[2,n];case 2:return a=t.sent(),[4,this.keyknoxClient.pushValue(i,s,a.toString(),n.keyknoxHash)];case 3:return u=t.sent(),[2,this.keyknoxCrypto.decrypt(u,this.myPrivateKey,this.myPublicKeys)]}})})},t}();function me(t){if(!t.byteLength)return new Map;var n=JSON.parse(t.toString());return Object.keys(n).reduce(function(t,e){var r=n[e];return t.set(e,{name:r.name,data:g.from(r.data,"base64"),creationDate:new Date(r.creation_date),modificationDate:new Date(r.modification_date),meta:void 0===r.meta?null:r.meta}),t},new Map)}var Ee=function(){function i(t){this.cache=new Map,this.syncWasCalled=!1,this.keyknoxManager=t}return i.create=function(t){return new i(new we(t.accessTokenProvider,t.privateKey,t.publicKeys))},i.prototype.storeEntries=function(r){return $(this,void 0,void 0,function(){var e=this;return Q(this,function(t){switch(t.label){case 0:return this.throwUnlessSyncWasCalled(),r.forEach(function(t){e.throwIfCloudEntryExists(t.name),e.cache.set(t.name,i.createCloudEntry(t))}),[4,this.pushCacheEntries()];case 1:return t.sent(),[2,r.map(function(t){return e.cache.get(t.name)})]}})})},i.prototype.storeEntry=function(e,r,n){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.storeEntries([{name:e,data:r,meta:n}])];case 1:return[2,t.sent()[0]]}})})},i.prototype.updateEntry=function(r,n,o){return $(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return this.throwUnlessSyncWasCalled(),this.throwUnlessCloudEntryExists(r),e=i.createCloudEntry({name:r,data:n,meta:o},this.cache.get(r).creationDate),this.cache.set(r,e),[4,this.pushCacheEntries()];case 1:return t.sent(),[2,e]}})})},i.prototype.retrieveEntry=function(t){return this.throwUnlessSyncWasCalled(),this.throwUnlessCloudEntryExists(t),this.cache.get(t)},i.prototype.retrieveAllEntries=function(){return this.throwUnlessSyncWasCalled(),Array.from(this.cache.values())},i.prototype.existsEntry=function(t){return this.throwUnlessSyncWasCalled(),this.cache.has(t)},i.prototype.deleteEntry=function(e){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.deleteEntries([e])];case 1:return t.sent(),[2]}})})},i.prototype.deleteEntries=function(r){return $(this,void 0,void 0,function(){var e=this;return Q(this,function(t){switch(t.label){case 0:return this.throwUnlessSyncWasCalled(),r.forEach(function(t){e.throwUnlessCloudEntryExists(t),e.cache.delete(t)}),[4,this.pushCacheEntries()];case 1:return t.sent(),[2]}})})},i.prototype.deleteAllEntries=function(){return $(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return this.cache.clear(),[4,(e=this).keyknoxManager.resetValue()];case 1:return e.decryptedKeyknoxValue=t.sent(),[2]}})})},i.prototype.updateRecipients=function(o){return $(this,void 0,void 0,function(){var e,r,n;return Q(this,function(t){switch(t.label){case 0:return this.throwUnlessSyncWasCalled(),e=o.newPrivateKey,r=o.newPublicKeys,[4,(n=this).keyknoxManager.updateRecipients({newPrivateKey:e,newPublicKeys:r})];case 1:return n.decryptedKeyknoxValue=t.sent(),this.cache=me(this.decryptedKeyknoxValue.value),[2]}})})},i.prototype.retrieveCloudEntries=function(){return $(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return[4,(e=this).keyknoxManager.pullValue()];case 1:return e.decryptedKeyknoxValue=t.sent(),this.cache=me(this.decryptedKeyknoxValue.value),this.syncWasCalled=!0,[2]}})})},i.prototype.throwUnlessSyncWasCalled=function(){if(!this.syncWasCalled)throw new he},i.prototype.throwUnlessCloudEntryExists=function(t){if(!this.cache.has(t))throw new pe(t)},i.prototype.throwIfCloudEntryExists=function(t){if(this.cache.has(t))throw new le(t)},i.prototype.pushCacheEntries=function(){return $(this,void 0,void 0,function(){var n,o;return Q(this,function(t){switch(t.label){case 0:return e=this.cache,r={},e.forEach(function(t,e){r[e]={data:t.data.toString("base64"),meta:t.meta,creation_date:Number(t.creationDate),name:t.name,modification_date:Number(t.modificationDate)},null===r[e].meta&&delete r[e].meta}),n=g.from(JSON.stringify(r)),[4,(o=this).keyknoxManager.pushValue(n,this.decryptedKeyknoxValue.keyknoxHash)];case 1:return o.decryptedKeyknoxValue=t.sent(),this.cache=me(this.decryptedKeyknoxValue.value),[2]}var e,r})})},i.createCloudEntry=function(t,e){var r=new Date;return{name:t.name,data:t.data,meta:void 0===t.meta?null:t.meta,creationDate:e||r,modificationDate:r}},i}(),be=function(){function t(t,e){var r=this;this.formatKeyEntry=function(t){return Z({},t,{name:t.name.replace(r.prefix,"")})},this.prefix="_VIRGIL_IDENTITY="+t+".",this.prefixRegExp=new RegExp("^"+this.prefix),this.keyEntryStorage=e}return t.prototype.save=function(r){return $(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return[4,this.keyEntryStorage.save(Z({},r,{name:this.getKeyEntryName(r.name)}))];case 1:return e=t.sent(),[2,this.formatKeyEntry(e)]}})})},t.prototype.load=function(r){return $(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return[4,this.keyEntryStorage.load(this.getKeyEntryName(r))];case 1:return null===(e=t.sent())?[2,null]:[2,this.formatKeyEntry(e)]}})})},t.prototype.exists=function(t){return this.keyEntryStorage.exists(this.getKeyEntryName(t))},t.prototype.remove=function(t){return this.keyEntryStorage.remove(this.getKeyEntryName(t))},t.prototype.list=function(){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.getAllKeyEntries()];case 1:return[2,t.sent().map(this.formatKeyEntry)]}})})},t.prototype.update=function(r){return $(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return[4,this.keyEntryStorage.update(Z({},r,{name:this.getKeyEntryName(r.name)}))];case 1:return e=t.sent(),[2,this.formatKeyEntry(e)]}})})},t.prototype.clear=function(){return $(this,void 0,void 0,function(){var e,r,n,o;return Q(this,function(t){switch(t.label){case 0:return[4,this.getAllKeyEntries()];case 1:e=t.sent(),r=0,n=e,t.label=2;case 2:return r<n.length?(o=n[r],[4,this.keyEntryStorage.remove(o.name)]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},t.prototype.getKeyEntryName=function(t){return""+this.prefix+t},t.prototype.getAllKeyEntries=function(){return $(this,void 0,void 0,function(){var e=this;return Q(this,function(t){switch(t.label){case 0:return[4,this.keyEntryStorage.list()];case 1:return[2,t.sent().filter(function(t){return e.prefixRegExp.test(t.name)})]}})})},t}();function ke(t){var e;return{name:t.name,value:t.data,meta:Z({},t.meta,(e={},e.k_cda=t.creationDate.toISOString(),e.k_mda=t.modificationDate.toISOString(),e))}}var xe=function(){function i(t,e,r){this.cloudKeyStorage=e,this.keyEntryStorageWrapper=new be(t,r)}return i.create=function(t){var e=t.identity,r=t.accessTokenProvider,n=t.privateKey,o=t.publicKeys;return new i(e,Ee.create({accessTokenProvider:r,privateKey:n,publicKeys:o}),t.keyEntryStorage)},i.prototype.storeEntries=function(i){return $(this,void 0,void 0,function(){var e,r,n,o=this;return Q(this,function(t){switch(t.label){case 0:return e=i.map(function(t){return o.throwIfKeyEntryExists(t.name)}),[4,Promise.all(e)];case 1:return t.sent(),[4,this.cloudKeyStorage.storeEntries(i)];case 2:return r=t.sent(),n=r.map(function(r){return $(o,void 0,void 0,function(){var e;return Q(this,function(t){return e=ke(r),[2,this.keyEntryStorageWrapper.save(e)]})})}),[2,Promise.all(n)]}})})},i.prototype.storeEntry=function(e,r,n){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.storeEntries([{name:e,data:r,meta:n}])];case 1:return[2,t.sent()[0]]}})})},i.prototype.updateEntry=function(n,o,i){return $(this,void 0,void 0,function(){var e,r;return Q(this,function(t){switch(t.label){case 0:return[4,this.throwUnlessKeyEntryExists(n)];case 1:return t.sent(),[4,this.cloudKeyStorage.updateEntry(n,o,i)];case 2:return e=t.sent(),r=ke(e),[4,this.keyEntryStorageWrapper.update(r)];case 3:return t.sent(),[2]}})})},i.prototype.retrieveEntry=function(e){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.throwUnlessKeyEntryExists(e)];case 1:return t.sent(),[2,this.keyEntryStorageWrapper.load(e)]}})})},i.prototype.retrieveAllEntries=function(){return this.keyEntryStorageWrapper.list()},i.prototype.existsEntry=function(t){return this.keyEntryStorageWrapper.exists(t)},i.prototype.deleteEntry=function(t){return this.deleteEntries([t])},i.prototype.deleteEntries=function(n){return $(this,void 0,void 0,function(){var e,r=this;return Q(this,function(t){switch(t.label){case 0:return[4,this.cloudKeyStorage.deleteEntries(n)];case 1:return t.sent(),e=n.map(function(t){return r.keyEntryStorageWrapper.remove(t)}),[4,Promise.all(e)];case 2:return t.sent(),[2]}})})},i.prototype.deleteAllEntries=function(){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.cloudKeyStorage.deleteAllEntries()];case 1:return t.sent(),[4,this.keyEntryStorageWrapper.clear()];case 2:return t.sent(),[2]}})})},i.prototype.updateRecipients=function(n){return $(this,void 0,void 0,function(){var e,r;return Q(this,function(t){return e=n.newPrivateKey,r=n.newPublicKeys,[2,this.cloudKeyStorage.updateRecipients({newPrivateKey:e,newPublicKeys:r})]})})},i.prototype.sync=function(){return $(this,void 0,void 0,function(){var e,r,n,o,i,s,a;return Q(this,function(t){switch(t.label){case 0:return[4,this.cloudKeyStorage.retrieveCloudEntries()];case 1:return t.sent(),e=this.cloudKeyStorage.retrieveAllEntries(),r=e.reduce(function(t,e){return t[e.name]=e,t},{}),[4,this.keyEntryStorageWrapper.list()];case 2:return n=t.sent(),o=n.reduce(function(t,e){return t[e.name]=e,t},{}),i=[],s=[],a=[],e.forEach(function(t){var e=o[t.name];if(e){var r=function(t){if(!t.meta)throw new TypeError("Invalid 'IKeyEntry'");return{creationDate:new Date(t.meta.k_cda),modificationDate:new Date(t.meta.k_mda)}}(e).modificationDate;if(t.modificationDate>r)return s.push(t.name)}else i.push(t.name)}),n.forEach(function(t){r[t.name]||a.push(t.name)}),[2,this.syncKeyStorage(i,s,a)]}})})},i.prototype.throwUnlessKeyEntryExists=function(e){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.keyEntryStorageWrapper.exists(e)];case 1:if(!t.sent())throw new de(e);return[2]}})})},i.prototype.throwIfKeyEntryExists=function(e){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.keyEntryStorageWrapper.exists(e)];case 1:if(t.sent())throw new ye(e);return[2]}})})},i.prototype.syncKeyStorage=function(i,s,a){return $(this,void 0,void 0,function(){var e,r,n,o=this;return Q(this,function(t){switch(t.label){case 0:return e=a.map(function(e){return $(o,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.keyEntryStorageWrapper.remove(e)];case 1:return t.sent(),[2]}})})}),r=s.map(function(n){return $(o,void 0,void 0,function(){var e,r;return Q(this,function(t){switch(t.label){case 0:return e=this.cloudKeyStorage.retrieveEntry(n),r=ke(e),[4,this.keyEntryStorageWrapper.update(r)];case 1:return t.sent(),[2]}})})}),n=i.map(function(n){return $(o,void 0,void 0,function(){var e,r;return Q(this,function(t){switch(t.label){case 0:return e=this.cloudKeyStorage.retrieveEntry(n),r=ke(e),[4,this.keyEntryStorageWrapper.save(r)];case 1:return t.sent(),[2]}})})}),[4,Promise.all(e.concat(r,n))];case 1:return t.sent(),[2]}})})},i}(),Ae=g;t.Buffer=Ae,t.KeyknoxClient=ge,t.KeyknoxCrypto=ve,t.CloudKeyStorage=Ee,t.KeyknoxManager=we,t.SyncKeyStorage=xe,t.KeyknoxError=ce,t.KeyknoxClientError=fe,t.CloudKeyStorageOutOfSyncError=he,t.CloudEntryExistsError=le,t.CloudEntryDoesntExistError=pe,t.KeyEntryExistsError=ye,t.KeyEntryDoesntExistError=de,Object.defineProperty(t,"__esModule",{value:!0})});
